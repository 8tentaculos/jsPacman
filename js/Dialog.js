import View from"rasti/View.js";import makeDot from"./factory/makeDot.js";class Dialog extends View{constructor(t={}){super(t),this.width=t.width||400,this.height=t.height||300,this.x=t.x||0,this.y=t.y||0,this.factor=t.factor||1,this.z=t.z||1e3,this.dotColor=t.dotColor||"white",this.borderWidth=t.borderWidth||8,this.dotSpacing=t.dotSpacing||2*this.borderWidth,this.content=t.content||"",this.scaling=t.scaling,this._previousActiveElement=null}render(){this.destroyChildren(),this.dots=[],this.el.innerHTML="";const t=this.width*this.factor,e=this.height*this.factor,i=this.borderWidth*this.factor;Object.assign(this.el.style,{position:"absolute",overflow:"visible",width:`${t}px`,height:`${e}px`,zIndex:this.z,transform:`translate(${this.x*this.factor}px, ${this.y*this.factor}px)`}),this.el.className="dialog";const s=Math.floor((this.width-this.borderWidth)/this.dotSpacing)+1;for(let t=0;t<s;t++){let e=t*this.dotSpacing;t===s-1&&(e=this.width-this.borderWidth);const i=this._createDot(e,0);this.dots.push(i),this.el.appendChild(i.el)}for(let t=0;t<s;t++){let e=t*this.dotSpacing;t===s-1&&(e=this.width-this.borderWidth);const i=this._createDot(e,this.height-this.borderWidth);this.dots.push(i),this.el.appendChild(i.el)}const o=this.height-this.borderWidth-this.dotSpacing;for(let t=this.dotSpacing;t<=o;t+=this.dotSpacing){const e=this._createDot(0,t);this.dots.push(e),this.el.appendChild(e.el)}for(let t=this.dotSpacing;t<=o;t+=this.dotSpacing){const e=this._createDot(this.width-this.borderWidth,t);this.dots.push(e),this.el.appendChild(e.el)}const n=this.$contentArea=document.createElement("div");return n.className="dialog-content",Object.assign(n.style,{position:"absolute",top:`${i}px`,left:`${i}px`,right:`${i}px`,bottom:`${i}px`,backgroundColor:"transparent",overflow:"hidden",padding:"1em",boxSizing:"border-box"}),this.content?n.innerHTML=this.content:this.renderContent(),this.el.appendChild(n),this}_createDot(t,e){const i=makeDot({x:t,y:e,factor:this.factor,defaultAnimation:this.dotColor});return this.addChild(i.render()),i.transform(),i}renderContent(){}_getFocusableElements(){const t=["button:not([disabled])","[href]",'input:not([disabled]):not([type="hidden"])',"select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])'].join(", ");return Array.from(this.$$(t)).filter(t=>{const e=window.getComputedStyle(t);return"none"!==e.display&&"hidden"!==e.visibility&&!t.hasAttribute("aria-hidden")})}_onKeyDown(t){if("none"===this.el.style.display)return;if("Tab"!==t.key)return;const e=this._getFocusableElements();if(0===e.length)return void t.preventDefault();const i=e[0],s=e[e.length-1],o=document.activeElement;if(!this.el.contains(o))return t.preventDefault(),void i.focus();const n=e.indexOf(o);if(-1===n)return t.preventDefault(),void i.focus();t.preventDefault(),t.stopPropagation(),t.shiftKey?0===n?s.focus():e[n-1].focus():n===e.length-1?i.focus():e[n+1].focus()}show(){this._previousActiveElement=document.activeElement,this.el.style.display="block",requestAnimationFrame(()=>{requestAnimationFrame(()=>{const t=this._getFocusableElements();t.length>0&&t[0].focus()})})}hide(){this.el.style.display="none",this._previousActiveElement&&requestAnimationFrame(()=>{document.body.contains(this._previousActiveElement)&&this._previousActiveElement.focus()}),this._previousActiveElement=null}}Dialog.prototype.events={keydown:"_onKeyDown"};export default Dialog;
import View from"rasti/View.js";export const EVENT_GAMEPAD_CONNECTED="gamepad:connected";export const EVENT_GAMEPAD_DISCONNECTED="gamepad:disconnected";export const EVENT_GAMEPAD_START="gamepad:start";export const DIRECTION_UP="u";export const DIRECTION_RIGHT="r";export const DIRECTION_DOWN="d";export const DIRECTION_LEFT="l";const defaults={deadZone:.3};class Gamepad extends View{constructor(t={}){super({...t,el:t.el||document&&document.body}),Object.keys(defaults).forEach(e=>{e in t&&(this[e]=t[e])}),this.directions={[DIRECTION_UP]:!1,[DIRECTION_RIGHT]:!1,[DIRECTION_DOWN]:!1,[DIRECTION_LEFT]:!1},this.gamepads=[],this._lastStartButtonState=!1,this.onGamepadConnected=this.onGamepadConnected.bind(this),this.onGamepadDisconnected=this.onGamepadDisconnected.bind(this),window.addEventListener("gamepadconnected",this.onGamepadConnected),window.addEventListener("gamepaddisconnected",this.onGamepadDisconnected),this.updateGamepadList()}onDestroy(){window.removeEventListener("gamepadconnected",this.onGamepadConnected),window.removeEventListener("gamepaddisconnected",this.onGamepadDisconnected)}onGamepadConnected(t){this.updateGamepadList(),this.emit("gamepad:connected",t.gamepad)}onGamepadDisconnected(t){this.updateGamepadList(),this.emit("gamepad:disconnected",t.gamepad),0===this.gamepads.length&&this.clear()}updateGamepadList(){const t=navigator.getGamepads?navigator.getGamepads():[];this.gamepads=Array.from(t).filter(t=>null!==t)}refresh(){if(this.updateGamepadList(),0===this.gamepads.length)return void this.clear();const t=this.gamepads[0];if(!t)return;const e=t.buttons[12]&&t.buttons[12].pressed||t.buttons[0]&&t.buttons[0].pressed||!1,s=t.buttons[13]&&t.buttons[13].pressed||t.buttons[1]&&t.buttons[1].pressed||!1,n=t.buttons[14]&&t.buttons[14].pressed||t.buttons[2]&&t.buttons[2].pressed||!1,a=t.buttons[15]&&t.buttons[15].pressed||t.buttons[3]&&t.buttons[3].pressed||!1,d=t.axes[0]||0,o=t.axes[1]||0,i=t.axes[2]||0,r=o,c=t.axes.length>2?i:d;let p=null;if(e?p="u":s?p="d":n?p="l":a&&(p="r"),!p){const t=Math.abs(r),e=Math.abs(c),s=t>this.deadZone,n=e>this.deadZone;(s||n)&&(n&&(!s||e>=t)?c<0?p="u":c>0&&(p="d"):s&&(p=r<0?"l":"r"))}this.directions.u="u"===p,this.directions.r="r"===p,this.directions.d="d"===p,this.directions.l="l"===p;const u=t.buttons[9]&&t.buttons[9].pressed||t.buttons[8]&&t.buttons[8].pressed||t.buttons[7]&&t.buttons[7].pressed||!1;u&&!this._lastStartButtonState&&this.emit("gamepad:start"),this._lastStartButtonState=u}clear(){this.directions={[DIRECTION_UP]:!1,[DIRECTION_RIGHT]:!1,[DIRECTION_DOWN]:!1,[DIRECTION_LEFT]:!1},this._lastStartButtonState=!1}getDirection(){return this.directions.u?"u":this.directions.r?"r":this.directions.d?"d":this.directions.l?"l":null}}Object.assign(Gamepad.prototype,defaults);export default Gamepad;
import Animation from"./engine/Animation.js";import Character from"./Character.js";import getDistance from"./helper/getDistance.js";export const animationBase={imageURL:"img/misc.png",offsetY:0,offsetX:0};export const animations={default:new Animation({...animationBase}),score100:new Animation({...animationBase,offsetY:60}),score200:new Animation({...animationBase,offsetX:60,offsetY:60}),score500:new Animation({...animationBase,offsetX:120,offsetY:60}),score700:new Animation({...animationBase,offsetX:180,offsetY:60}),score1000:new Animation({...animationBase,offsetX:240,offsetY:60}),score2000:new Animation({...animationBase,offsetX:300,offsetY:60}),score5000:new Animation({...animationBase,offsetX:360,offsetY:60})};const defaults={animations:animations,speed:40,score:"100"};class Bonus extends Character{constructor(t){super(t),Object.keys(defaults).forEach(e=>{e in t&&(this[e]=t[e])}),this.getPacmanData=t.getPacmanData,this.on("item:tile",()=>{this._dir=this._nextDir,this._nextDir=this.getNextDirection(),this._eatEvent=!1,this.getTile()===this._getTarget()&&(this._targetFound?this._targetFound--:this.emit("item:destroy"))}),this._targetFound=2}move(){if(Character.prototype.move.call(this,this._dir),!this._eatEvent){const t=this.getPacmanData(),e=t.tile,i=this.getTile(),s=this._getOpDirection(this._dir);(e===i||t.dir===s&&e===i.get(s))&&(this._eatEvent=!0,this._nextAnimation=this.animations[`score${this.score}`],this.update(),this.emit("item:eaten",this))}}getNextDirection(){for(var t,e,i=this._getTarget(),s=this._dir||this.dir,n=this.getTile().get(s),a=["u","l","d","r"],o=0;o<4;o++){var r=a[o];if(r!==this._getOpDirection(s)&&this.canGo(r,n)){var m=n.get(r),f=getDistance(m,i);(void 0===e||e>f)&&(t=r,e=f)}}return t}canGo(t,e){e||(e=this.getTile());var i=e.get(t);return!!i&&(!i.isWall()&&!i.isHouse())}_getTarget(){return this.map.tunnels[0]}setNextAnimation(){}}Object.assign(Bonus.prototype,defaults);export default Bonus;
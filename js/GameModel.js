import Model from"./engine/Model.js";import Timer from"./engine/Timer.js";import{MODE_SCATTER,MODE_CHASE}from"./Ghost.js";import map1 from"./maps/map-1.js";import map2 from"./maps/map-2.js";import map3 from"./maps/map-3.js";import map4 from"./maps/map-4.js";const times=[{mode:MODE_SCATTER,time:7},{mode:MODE_CHASE,time:20},{mode:MODE_SCATTER,time:7},{mode:MODE_CHASE,time:20},{mode:MODE_SCATTER,time:5},{mode:MODE_CHASE,time:20},{mode:MODE_SCATTER,time:5},{mode:MODE_CHASE,time:1e6}];var data=[[times,0,100,80,71,75,40,20,80,10,85,90,79,50,6,5,map1,"maze-1"],[times,1,200,90,79,85,45,30,90,15,95,95,83,55,5,5,map1,"maze-1"],[times,2,500,90,79,85,45,40,90,20,95,95,83,55,4,5,map2,"maze-2"],[times,3,500,90,79,85,45,40,90,20,95,95,83,55,3,5,map2,"maze-2"],[times,4,700,100,87,95,50,40,100,20,105,100,87,60,2,5,map2,"maze-2"],[times,5,700,100,87,95,50,50,100,25,105,100,87,60,5,5,map3,"maze-3"],[times,6,1e3,100,87,95,50,50,100,25,105,100,87,60,2,5,map3,"maze-3"],[times,7,1e3,100,87,95,50,50,100,25,105,100,87,60,2,5,map3,"maze-3"],[times,0,2e3,100,87,95,50,60,100,30,105,100,87,60,1,3,map3,"maze-3"],[times,1,2e3,100,87,95,50,60,100,30,105,100,87,60,5,5,map4,"maze-4"],[times,2,2e3,100,87,95,50,60,100,30,105,100,87,60,2,5,map4,"maze-4"],[times,3,2e3,100,87,95,50,80,100,40,105,100,87,60,1,3,map4,"maze-4"],[times,4,5e3,100,87,95,50,80,100,40,105,100,87,60,1,3,map4,"maze-4"],[times,5,5e3,100,87,95,50,80,100,40,105,100,87,60,3,5,map3,"maze-3"],[times,6,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,map3,"maze-3"],[times,7,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,map3,"maze-3"],[times,7,5e3,100,87,95,50,100,100,50,105,0,0,0,0,0,map3,"maze-3"],[times,7,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,map4,"maze-4"],[times,7,5e3,100,87,95,50,120,100,60,105,0,0,0,0,0,map4,"maze-4"],[times,7,5e3,100,87,95,50,120,100,60,105,0,0,0,0,0,map4,"maze-4"],[times,7,5e3,90,79,95,50,120,100,60,105,0,0,0,0,0,map4,"maze-4"]],keys=["game.times","game.bonusIndex","game.bonusScore","pacman.speed","pacman.dotSpeed","ghost.speed","ghost.tunnelSpeed","","","","","pacman.frightenedSpeed","pacman.frightenedDotSpeed","ghost.frightenedSpeed","ghost.frightenedTime","ghost.frightenedFlashes","game.map","game.maze"];export const STATUS_SPLASH="splash";export const STATUS_INTRO="intro";export const STATUS_INTRO_OUT="introOut";export const STATUS_PLAY="play";export const STATUS_PAUSED="paused";export const STATUS_GAME_OVER="gameOver";export const STATUS_WIN="win";class GameModel extends Model{constructor(e){super(e),this.url="jsPacman",this.on("change:score",this.onChangeScore.bind(this))}preinitialize(){this.defaults={status:"splash",level:1,score:0,highScore:0,lives:3,extraLives:1,extraLifeScore:1e4,mode:null,mainMenuOpen:!1,soundEnabled:!0,overlayEnabled:!0}}addScore(e){this.score=this.score+e}updateMode(){this.mode||(this.modeTimer=new Timer);const{times:e}=this.getSettings("game");let m=0,t=0;for(;e[t];){if(m+=e[t].time,!this.modeTimer.isElapsed(m)||t===e.length-1){this.mode=e[t].mode;break}t++}}pause(){this.modeTimer&&this.modeTimer.pause()}resume(){this.modeTimer&&this.modeTimer.resume()}getSettings(e){const m={},t=this.level>data.length?data.length:this.level;let s=keys.length;for(;s--;){let a=keys[s].split(".");a[0]===e&&(m[a[1]]=data[t-1][s])}return m}onChangeScore(){this.extraLives&&this.score>=this.extraLifeScore&&(this.extraLives--,this.lives++),this.highScore<this.score&&(this.highScore=this.score)}toJSON(){return{highScore:this.highScore,soundEnabled:this.soundEnabled,overlayEnabled:this.overlayEnabled}}}export default GameModel;
import Animation,{ANIMATION_HORIZONTAL}from"./engine/Animation.js";import Character from"./Character.js";const animationBase={imageURL:"img/characters.png",numberOfFrame:4,delta:64,refreshRate:60,offsetY:60,type:ANIMATION_HORIZONTAL},animations={right:new Animation({...animationBase}),down:new Animation({...animationBase,offsetX:256}),up:new Animation({...animationBase,offsetX:512}),left:new Animation({...animationBase,offsetX:768})},defaults={animations:animations,dir:"l",defaultAnimation:"left",preturn:!0,frightenedSpeed:null,frightenedDotSpeed:null,dotSpeed:null};class Pacman extends Character{constructor(e){super(e),Object.keys(defaults).forEach(t=>{t in e&&(this[t]=e[t])});const{addGameGhostEatEventListener:t,addGameGhostModeFrightenedEnter:i,addGameGhostModeFrightenedExit:s}=e;this._ghostFrightened=[],this.on("item:tile",e=>{this._ghostFrightened.length?this._speed=this.frightenedSpeed:this._speed=this.speed,e.item&&(e.hasPill()?this.emit("item:eatpill",e):e.hasDot()&&(this.emit("item:eatdot",e),this._ghostFrightened.length?this._speed=this.frightenedDotSpeed:this._speed=this.dotSpeed),e.item.destroy(),e.item=null)}),t(()=>{this._eatenTurns=9,this.dir="r",this.pauseAnimation()}),i(e=>{this._ghostFrightened=this._ghostFrightened.filter(t=>t!==e).concat([e])}),s(e=>{this._ghostFrightened=this._ghostFrightened.filter(t=>t!==e)})}reset(){Character.prototype.reset.apply(this),this._lastEatenTurnsTime=null}move(){if(this._eatenTurns)if(this._eatenTurnsFrames)this._eatenTurnsFrames--;else{if(9===this._eatenTurns&&this.emit("item:die"),this._eatenTurns>2){this.dir={d:"l",l:"u",u:"r",r:"d"}[this.dir],this.setNextAnimation(),this.update(),this._eatenTurnsFrames=5}else this._eatenTurnsFrames=25;this._eatenTurns--,0===this._eatenTurns&&this.emit("item:life")}else Character.prototype.move.apply(this,arguments)}}Object.assign(Pacman.prototype,defaults);export default Pacman;
(()=>{"use strict";var t={56:(t,e,s)=>{t.exports=function(t){var e=s.nc;e&&t.setAttribute("nonce",e)}},72:t=>{var e=[];function s(t){for(var s=-1,i=0;i<e.length;i++)if(e[i].identifier===t){s=i;break}return s}function i(t,i){for(var h={},a=[],r=0;r<t.length;r++){var o=t[r],d=i.base?o[0]+i.base:o[0],l=h[d]||0,c="".concat(d," ").concat(l);h[d]=l+1;var u=s(c),m={css:o[1],media:o[2],sourceMap:o[3],supports:o[4],layer:o[5]};if(-1!==u)e[u].references++,e[u].updater(m);else{var p=n(m,i);i.byIndex=r,e.splice(r,0,{identifier:c,updater:p,references:1})}a.push(c)}return a}function n(t,e){var s=e.domAPI(e);return s.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;s.update(t=e)}else s.remove()}}t.exports=function(t,n){var h=i(t=t||[],n=n||{});return function(t){t=t||[];for(var a=0;a<h.length;a++){var r=s(h[a]);e[r].references--}for(var o=i(t,n),d=0;d<h.length;d++){var l=s(h[d]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}h=o}}},96:(t,e,s)=>{t.exports=s.p+"./fonts/press-start-2p-v9-latin-regular.woff"},113:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},314:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var s="",i=void 0!==e[5];return e[4]&&(s+="@supports (".concat(e[4],") {")),e[2]&&(s+="@media ".concat(e[2]," {")),i&&(s+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),s+=t(e),i&&(s+="}"),e[2]&&(s+="}"),e[4]&&(s+="}"),s})).join("")},e.i=function(t,s,i,n,h){"string"==typeof t&&(t=[[null,t,void 0]]);var a={};if(i)for(var r=0;r<this.length;r++){var o=this[r][0];null!=o&&(a[o]=!0)}for(var d=0;d<t.length;d++){var l=[].concat(t[d]);i&&a[l[0]]||(void 0!==h&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=h),s&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=s):l[2]=s),n&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=n):l[4]="".concat(n)),e.push(l))}},e}},365:(t,e,s)=>{s.d(e,{A:()=>b});var i=s(601),n=s.n(i),h=s(314),a=s.n(h),r=s(417),o=s.n(r),d=new URL(s(834),s.b),l=new URL(s(96),s.b),c=new URL(s(522),s.b),u=new URL(s(507),s.b),m=a()(n()),p=o()(d),g=o()(l),f=o()(c),y=o()(u);m.push([t.id,`/* press-start-2p-regular - latin */\n@font-face {\n  font-family: 'Press Start 2P';\n  font-style: normal;\n  font-weight: 400;\n  src: local(''),\n       url(${p}) format('woff2'), /* Chrome 26+, Opera 23+, Firefox 39+ */\n       url(${g}) format('woff'); /* Chrome 6+, Firefox 3.6+, IE 9+, Safari 5.1+ */\n}\n\nbody {\n    background-color: #222;\n    margin: 0;\n    padding: 0;\n    overflow: hidden;\n}\n\n.js-pacman-playground {\n    position: absolute;\n    color: #EFEFEF;\n    font-family: 'Press Start 2P', cursive;\n    font-size: 2em;\n    background-color: #000;\n    background-image: url(${f});\n    background-size: 400% 200%;\n    display: none;\n    cursor: default;\n    user-select: none;\n    touch-action: none;\n}\n\n.js-pacman-playground.with-border {\n    border-radius: 0.5em;\n    border: 1em solid #000;\n}\n\n.js-pacman-playground.with-border.with-light {\n    box-shadow: 0 0 1em 0.1em #EEE;\n}\n\n.js-pacman-playground.maze-1 {\n    background-position: 0 0;\n}\n\n.js-pacman-playground.maze-2 {\n    background-position: -100% 0;\n}\n\n.js-pacman-playground.maze-3 {\n    background-position: -200% 0;\n}\n\n.js-pacman-playground.maze-4 {\n    background-position: -300% 0;\n}\n\n.js-pacman-playground.maze-1.blink {\n    background-position: 0 -100%;\n}\n\n.js-pacman-playground.maze-2.blink {\n    background-position: -100% -100%;\n}\n\n.js-pacman-playground.maze-3.blink {\n    background-position: -200% -100%;\n}\n\n.js-pacman-playground.maze-4.blink {\n    background-position: -300% -100%;\n}\n\n.js-pacman-playground .splash {\n    background-image: url(${y});\n    background-size: 100% 100%;\n    background-color: #000;\n    text-align: center;\n    position: absolute;\n    top: 0;\n    bottom: 0;\n    right: 0;\n    left: 0;\n    z-index: 1;\n}\n\n.js-pacman-playground .splash a {\n    color: #DDDDDD;\n    cursor: pointer;\n    font-weight: bold;\n}\n\n.js-pacman-playground .splash a:hover {\n    color: #FFF;\n}\n\n.js-pacman-playground .splash a.start {\n    position: relative;\n    top: 65%;\n    text-transform: uppercase;\n    font-size: 1.6em;\n}\n\n.js-pacman-playground .splash .title {\n    position: absolute;\n    top: 22.04%;\n    left: 0;\n    right: 0;\n    text-align: center;\n    color: #FCB644;\n}\n\n.js-pacman-playground .splash p.nerd {\n    position: absolute;\n    top: 33.15%;\n    left: 35.26%;\n    text-align: center;\n    color: #FFF;\n}\n\n.js-pacman-playground .splash p span {\n    color : #FFFF00;\n}\n\n.js-pacman-playground .splash .keys {\n    position: absolute;\n    top: 85%;\n    left: 0;\n    right: 0;\n    text-align: center;\n    color: #FFF;\n}\n\n.js-pacman-playground .splash .credits {\n    font-family: 'Press Start 2P', cursive;\n    position: absolute;\n    bottom: 0;\n    left: 0;\n    right: 0;\n    color: #FFF;\n    padding: 0.1em;\n    font-size: 0.6em;\n}\n\n.js-pacman-playground .splash .credits span {\n    color: #FF3333;\n}\n\n.js-pacman-playground .splash .credits a {\n    color: #FFFF00;\n}\n\n.js-pacman-playground .splash .credits a:hover {\n    color: #FFFF4D;\n}\n\n.js-pacman-playground .loadbar {\n    position: absolute;\n    top: 65%;\n    left: 22.32%;\n    right: 22.32%;\n    background: #FF0;\n    height: 3.472%;\n    overflow: visible;\n    border: 2px solid #FFF;\n}\n\n.js-pacman-playground .loadbar .inner {\n    position: relative;\n    background: #FF0000;\n    height: 100%;\n    width: 0;\n}\n\n.js-pacman-playground .score {\n    position: absolute;\n    top: 0;\n    right: 0.4464%;\n    left: 0.4464%;\n    text-align: center;\n    z-index: 2\n}\n\n.js-pacman-playground .score .p1-score {\n    position: absolute;\n    width: 22%;\n    top: 0;\n    left: 0;\n}\n\n.js-pacman-playground .score .high-score {\n    width: 40%;\n    margin-left: auto;\n    margin-right: auto;\n}\n\n.js-pacman-playground .score .p2-score {\n    position: absolute;\n    width: 22%;\n    top: 0;\n    right: 0;\n}\n\n.js-pacman-playground .score span {\n    text-align: right;\n    display: block;\n}\n\n.js-pacman-playground .score .high-score span {\n    text-align: center;\n}\n\n.js-pacman-playground .start-p1 {\n    position: absolute;\n    top: 38.71%;\n    left: 0;\n    right: 0;\n    text-align: center;\n    color: #5EE;\n}\n\n.js-pacman-playground .game-over,\n.js-pacman-playground .start-ready,\n.js-pacman-playground .sound-status,\n.js-pacman-playground .paused {\n    position: absolute;\n    top: 55.55%;\n    left: 0;\n    right: 0;\n    text-align: center;\n    color: #F00;\n}\n\n.js-pacman-playground .sound-status.on span.on,\n.js-pacman-playground .sound-status span.off {\n    display : inline;\n}\n\n.js-pacman-playground .sound-status.on span.off,\n.js-pacman-playground .sound-status span.on {\n    display : none;\n}\n\n.js-pacman-playground .sound-status .wrap,\n.js-pacman-playground .paused .wrap {\n    background: #000;\n    padding: 0.1em;\n}\n\n@media screen and (orientation: portrait) {\n    /* body {\n        background-color: #000;\n    }\n\n    .js-pacman-playground.with-border {\n        border-radius: 0;\n        box-shadow: none;\n        border: none;\n    } */\n}\n`,""]);const b=m},417:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},507:(t,e,s)=>{t.exports=s.p+"./img/start.png"},522:(t,e,s)=>{t.exports=s.p+"./img/maze.png"},540:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},601:t=>{t.exports=function(t){return t[1]}},659:t=>{var e={};t.exports=function(t,s){var i=function(t){if(void 0===e[t]){var s=document.querySelector(t);if(window.HTMLIFrameElement&&s instanceof window.HTMLIFrameElement)try{s=s.contentDocument.head}catch(t){s=null}e[t]=s}return e[t]}(t);if(!i)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");i.appendChild(s)}},825:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(s){!function(t,e,s){var i="";s.supports&&(i+="@supports (".concat(s.supports,") {")),s.media&&(i+="@media ".concat(s.media," {"));var n=void 0!==s.layer;n&&(i+="@layer".concat(s.layer.length>0?" ".concat(s.layer):""," {")),i+=s.css,n&&(i+="}"),s.media&&(i+="}"),s.supports&&(i+="}");var h=s.sourceMap;h&&"undefined"!=typeof btoa&&(i+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(h))))," */")),e.styleTagTransform(i,t,e.options)}(e,t,s)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},834:(t,e,s)=>{t.exports=s.p+"./fonts/press-start-2p-v9-latin-regular.woff2"}},e={};function s(i){var n=e[i];if(void 0!==n)return n.exports;var h=e[i]={id:i,exports:{}};return t[i](h,h.exports,s),h.exports}s.m=t,s.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return s.d(e,{a:e}),e},s.d=(t,e)=>{for(var i in e)s.o(e,i)&&!s.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},s.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),s.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;s.g.importScripts&&(t=s.g.location+"");var e=s.g.document;if(!t&&e&&(e.currentScript&&"SCRIPT"===e.currentScript.tagName.toUpperCase()&&(t=e.currentScript.src),!t)){var i=e.getElementsByTagName("script");if(i.length)for(var n=i.length-1;n>-1&&(!t||!/^http(s?):/.test(t));)t=i[n--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/^blob:/,"").replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),s.p=t})(),s.b=document.baseURI||self.location.href,s.nc=void 0,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p,s.p;var i=s(72),n=s.n(i),h=s(825),a=s.n(h),r=s(659),o=s.n(r),d=s(56),l=s.n(d),c=s(540),u=s.n(c),m=s(113),p=s.n(m),g=s(365),f={};f.styleTagTransform=p(),f.setAttributes=l(),f.insert=o().bind(null,"head"),f.domAPI=a(),f.insertStyleElement=u(),n()(g.A,f),g.A&&g.A.locals&&g.A.locals;class y{on(t,e){if("function"!=typeof e)throw new TypeError("Listener must be a function");return this.listeners||(this.listeners={}),this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e),()=>this.off(t,e)}once(t,e){if("function"==typeof e){const s=this,i=e;e=function(...n){i(...n),s.off(t,e)}}return this.on(t,e)}off(t,e){this.listeners&&(t?this.listeners[t]&&(e?(this.listeners[t]=this.listeners[t].filter((t=>t!==e)),this.listeners[t].length||delete this.listeners[t]):delete this.listeners[t],Object.keys(this.listeners).length||delete this.listeners):delete this.listeners)}emit(t,...e){this.listeners&&this.listeners[t]&&this.listeners[t].slice().forEach((function(t){t(...e)}))}}var b=(t,e,...s)=>"function"!=typeof t?t:t.apply(e,s);class v extends y{constructor(t={}){super(),this.preinitialize.apply(this,arguments);const e=b(this.defaults,this)||{};this.attributes=Object.assign({},e,t),this.previous={},Object.keys(this.attributes).forEach(this.defineAttribute.bind(this))}preinitialize(){}defineAttribute(t){Object.defineProperty(this,t,{get:()=>this.get(t),set:e=>{this.set(t,e)}})}get(t){return this.attributes[t]}set(t,e,...s){let i,n;"object"==typeof t?(i=t,n=[e,...s]):(i={[t]:e},n=s);const h=this._changing;this._changing=!0;const a={};h||(this.previous=Object.assign({},this.attributes)),Object.keys(i).forEach((t=>{i[t]!==this.attributes[t]&&(a[t]=i[t],this.attributes[t]=i[t])}));const r=Object.keys(a);if(r.length&&(this._pending=["change",this,a,...n]),r.forEach((t=>{this.emit(`change:${t}`,this,i[t],...n)})),h)return this;for(;this._pending;){const t=this._pending;this._pending=null,this.emit.apply(this,t)}return this._pending=null,this._changing=!1,this}toJSON(){return Object.assign({},this.attributes)}}const w={el:!0,tag:!0,attributes:!0,events:!0,model:!0,template:!0,onDestroy:!0};class _ extends y{constructor(t={}){super(),this.preinitialize.apply(this,arguments),this.uid="uid"+ ++_.uid,this.delegatedEventListeners=[],this.children=[],this.destroyQueue=[],Object.keys(t).forEach((e=>{w[e]&&(this[e]=t[e])})),this.ensureElement()}preinitialize(){}$(t){return this.el.querySelector(t)}$$(t){return this.el.querySelectorAll(t)}destroy(){return this.destroyChildren(),this.undelegateEvents(),this.off(),this.destroyQueue.forEach((t=>t())),this.destroyQueue=[],this.onDestroy.apply(this,arguments),this}onDestroy(){}addChild(t){return this.children.push(t),t}destroyChildren(){this.children.forEach((t=>t.destroy())),this.children=[]}ensureElement(){if(this.el)this.el=b(this.el,this);else{const t=b(this.tag,this),e=b(this.attributes,this);this.el=this.createElement(t,e)}this.delegateEvents()}createElement(t="div",e={}){let s=document.createElement(t);return Object.keys(e).forEach((t=>s.setAttribute(t,e[t]))),s}removeElement(){return this.el.parentNode.removeChild(this.el),this}delegateEvents(t){if(t||(t=b(this.events,this)),!t)return this;this.delegatedEventListeners.length&&this.undelegateEvents();let e={};return Object.keys(t).forEach((s=>{const i=s.split(" "),n=i.shift(),h=i.join(" ");let a=t[s];a=("string"==typeof a?this[a]:a).bind(this),e[n]||(e[n]=[]),e[n].push({selector:h,listener:a})})),Object.keys(e).forEach((t=>{const s=s=>{e[t].forEach((({selector:t,listener:e})=>{t&&!s.target.closest(t)||e(s,this)}))};this.delegatedEventListeners.push({type:t,listener:s}),this.el.addEventListener(t,s)})),this}undelegateEvents(){return this.delegatedEventListeners.forEach((({type:t,listener:e})=>{this.el.removeEventListener(t,e)})),this.delegatedEventListeners=[],this}render(){return this.template&&(this.el.innerHTML=this.template(this.model)),this}static sanitize(t){return`${t}`.replace(/[&<>"']/g,(t=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"}[t])))}}_.uid=0;const E=t=>t.reduce(((t,e)=>(Array.isArray(e)?t.push(...E(e)):t.push(e),t)),[]);class x{constructor(t){this.value=t}toString(){return this.value}}const T=(t,e)=>b(t,e,e),k=(t,e)=>t.reduce(((t,s,i)=>(t.push(s),void 0!==e[i]&&t.push(j.PLACEHOLDER_EXPRESSION(i)),t)),[]).join(""),S=(t,e)=>{const s=j.PLACEHOLDER_EXPRESSION("(\\d+)"),i=new RegExp(`${s}`,"g"),n=[];let h,a=0;for(;null!==(h=i.exec(t));){const s=t.slice(a,h.index);n.push(j.markAsSafeHTML(s),e[h[1]]),a=h.index+h[0].length}return n.push(j.markAsSafeHTML(t.slice(a))),n},R=(t,e)=>{const s=t.reduce(((t,s)=>{const i=e(s[0]);if(1===s.length)"object"==typeof i?t.all=Object.assign(t.all,i):"string"==typeof i&&(t.all[i]=!0);else{const n=e(s[1]);t.all[i]=n}return t}),{all:{},events:{},attributes:{}});return Object.keys(s.all).forEach((t=>{const e=t.match(/on(([A-Z]{1}[a-z]+)+)/);e&&e[1]?s.events[e[1].toLowerCase()]=s.all[t]:s.attributes[t]=s.all[t]})),s},F=(t,e)=>{const s=j.PLACEHOLDER_EXPRESSION("(\\d+)");return t.replace(new RegExp(`<(${s})([^>]*)>([\\s\\S]*?)</(${s})>|<(${s})([^>]*)/>`,"g"),(function(){const{tag:t,attributes:s,inner:i,close:n,raw:h}=O(arguments,e);if(!(t.prototype instanceof j))return h;let a;if(n){if(t!==n)return h;const s=S(F(i,e),e);a=function(){return E(s.map((t=>T(t,this))))}}return e.push((function(){const e=R(s,(t=>T(t,this))).all;return a&&(e.renderChildren=a.bind(this)),t.mount(e)})),j.PLACEHOLDER_EXPRESSION(e.length-1)}))},O=(t,e)=>{const s=j.PLACEHOLDER_EXPRESSION("(\\d+)"),[i,n,h,a,r,o,d,l,c,u]=t,m={raw:i,attributes:[]};let p;n?(m.tag=void 0!==h?e[h]:n,m.inner=r,m.close=void 0!==d?e[d]:o,p=a):(m.tag=void 0!==c?e[c]:l,p=u);const g=new RegExp(`(${s}|[\\w-]+)(?:=(["']?)(?:${s}|((?:.?(?!["']?\\s+(?:\\S+)=|\\s*/?[>"']))+.))\\3)?`,"g");let f;for(;null!==(f=g.exec(p));){const[,t,s,,i,n]=f,h=void 0!==s?e[s]:t,a=void 0!==i?e[i]:n;void 0!==a?m.attributes.push([h,a]):m.attributes.push([h])}return m},L={area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,link:!0,meta:!0,source:!0,track:!0,wbr:!0},D={key:!0,state:!0,onCreate:!0,onChange:!0,onRender:!0};class j extends _{constructor(t={}){super(...arguments),Object.keys(t).forEach((e=>{D[e]&&(this[e]=t[e])})),this.options=t,this.partial=this.partial.bind(this),this.onCreate.apply(this,arguments)}subscribe(t){if(!t.on)return;const e=this.onChange.bind(this),s=t.on("change",e);return this.destroyQueue.push("function"==typeof s?s:()=>t.off("change",e)),this}isContainer(){return!(this.tag||!this.template)}ensureElement(){this.el&&(this.el=b(this.el,this),this.delegateEvents())}findElement(t){return(t||document).querySelector(`[${j.DATA_ATTRIBUTE_UID}="${this.uid}"]`)}getAttributes(){const t={},e={},s=[],i={[j.DATA_ATTRIBUTE_UID]:this.uid};this.attributes&&Object.assign(i,b(this.attributes,this));const n=this.previousAttributes||{};return this.previousAttributes=i,Object.keys(i).forEach((n=>{let h=i[n];!1===h?e[n]=!0:!0===h?(t[n]="",s.push(n)):(null==h&&(h=""),t[n]=h,s.push(`${j.sanitize(n)}="${j.sanitize(h)}"`))})),Object.keys(n).forEach((t=>{t in i||(e[t]=!0)})),{add:t,remove:e,html:s.join(" ")}}hydrate(t){return this.model&&this.subscribe(this.model),this.state&&this.subscribe(this.state),this.isContainer()?(this.children[0].hydrate(t),this.el=this.children[0].el):(this.el=this.findElement(t),this.delegateEvents(),this.children.forEach((t=>t.hydrate(this.el)))),this.onRender.call(this,j.RENDER_TYPE_HYDRATE),this}recycle(t){return this.isContainer()?this.children[0].recycle(t):(this.findElement(t).replaceWith(this.el),this.onRender.call(this,j.RENDER_TYPE_RECYCLE),this)}destroy(){return super.destroy.apply(this,arguments),this.destroyed=!0,this}onCreate(){}onChange(){this.render()}onRender(){}onDestroy(){}partial(t,...e){return E(S(F(k(t,e),e),e).map((t=>T(t,this))))}getRecyclePlaceholder(){if(this.isContainer())return this.children[0].getRecyclePlaceholder();const t=b(this.tag,this)||"div",e=`${j.DATA_ATTRIBUTE_UID}="${this.uid}"`;return this.template||!L[t]?`<${t} ${e}></${t}>`:`<${t} ${e} />`}toString(){if(this.destroyChildren(),this.isContainer())return this.template.call(this,this.addChild.bind(this));const t=b(this.tag,this)||"div",e=this.getAttributes().html,s=this.template?this.template.call(this,this.addChild.bind(this)):"";return this.template||!L[t]?`<${t} ${e}>${s}</${t}>`:`<${t} ${e} />`}render(){if(this.destroyed)return this;if(!this.isContainer()){if(!this.el){const t=this.createElement("template");return t.innerHTML=this,this.hydrate(t.content),this}const t=this.getAttributes();Object.keys(t.remove).forEach((t=>{this.el.removeAttribute(t)})),Object.keys(t.add).forEach((e=>{this.el.setAttribute(e,t.add[e])}))}if(this.template){const t=document.activeElement,e=[],s=[],i=this.children;this.children=[];const n=this.template.call(this,(t=>{let n=t;const h=t.key&&i.find((e=>e.key===t.key));return h?(n=h.getRecyclePlaceholder(),s.push(h),t.destroy()):e.push(t),n}));if(this.isContainer())if(e[0]){const t=this.createElement("template");t.innerHTML=n,this.addChild(e[0]).hydrate(t.content);const s=t.content.children[0];this.el&&this.el.replaceWith(s),this.el=s}else{if(!s[0])throw new Error("Container component must have a child component");this.addChild(s[0])}else this.el.innerHTML=n,e.forEach((t=>{this.addChild(t).hydrate(this.el)})),s.forEach((t=>{this.addChild(t).recycle(this.el)}));i.forEach((t=>{s.indexOf(t)>-1||t.destroy()})),this.el.contains(t)&&t.focus()}return this.onRender.call(this,j.RENDER_TYPE_RENDER),this}static markAsSafeHTML(t){return new x(t)}static extend(t){const e=this;class s extends e{}return Object.assign(s.prototype,"function"==typeof t?t(e.prototype):t),s}static mount(t,e,s){const i=new this(t);return e&&(s?(i.toString(),i.hydrate(e)):e.appendChild(i.render().el)),i}static create(t,...e){const s=j.PLACEHOLDER_EXPRESSION("(\\d+)");let i,n,h,a;"function"==typeof t&&(e=[t],t=["",""]);const r=F(k(t,e),e);let o=r.match(new RegExp(`^\\s*<([a-z]+[1-6]?|${s})([^>]*)>([\\s\\S]*?)</(\\1|${s})>\\s*$|^\\s*<([a-z]+[1-6]?|${s})([^>]*)/>\\s*$`));if(o){const{tag:t,attributes:s,inner:r,close:d}=O(o,e);if(i=function(){return j.sanitize(T(t,this))},n=function(){return R(s,(t=>T(t,this))).attributes},h=function(){const t=R(s,(t=>T(t,this))).events;return Object.keys(t).reduce(((e,s)=>{const i=T(t[s],this);return Object.keys(i).forEach((t=>{e[`${s}${"&"===t?"":` ${t}`}`]=i[t]})),e}),{})},d){const t=r?S(r,e):[];a=function(e){return E(t.map((t=>T(t,this)))).map((t=>null!=t&&!1!==t&&!0!==t?t instanceof x?t:t instanceof j?e(t):j.sanitize(t):"")).join("")}}}else{if(o=r.match(new RegExp(`^\\s*${s}\\s*$`)),!o)throw new SyntaxError("Invalid component");a=function(t){return t(T(e[o[1]],this)).toString()}}return this.extend({tag:i,attributes:n,events:h,template:a})}}j.PLACEHOLDER_EXPRESSION=t=>`__RASTI_{${t}}__`,j.DATA_ATTRIBUTE_UID="data-rasti-uid",j.RENDER_TYPE_HYDRATE="hydrate",j.RENDER_TYPE_RECYCLE="recycle",j.RENDER_TYPE_RENDER="render";const A="keydown";class C extends _{constructor(t){super({el:document&&document.body,...t}),this.keys={}}onKeyUp(t){this.keys[t.keyCode]=!1,this.emit("keyup",t)}onKeyDown(t){this.keys[t.keyCode]=!0,this.emit(A,t)}clear(){this.keys={}}}C.prototype.events={keyup:"onKeyUp",keydown:"onKeyDown"};const P=C,z="swipe",M="swipe:up",I="swipe:right",$="swipe:down",X="swipe:left",Y={threshold:100,restraint:150,allowedTime:400};class G extends _{constructor(t={}){super({...t,el:t.el||document&&document.body}),Object.keys(Y).forEach((e=>{e in t&&(this[e]=t[e])})),this.onTouchStart=this.onTouchStart.bind(this),this.onTouchEnd=this.onTouchEnd.bind(this),this.el.addEventListener("touchstart",this.onTouchStart,!1),this.el.addEventListener("touchend",this.onTouchEnd,!1)}onDestroy(){this.el.removeEventListener("touchstart",this.onTouchStart),this.el.removeEventListener("touchend",this.onTouchEnd)}onTouchStart(t){const e=t.changedTouches[0];this.startX=e.pageX,this.startY=e.pageY,this.startTime=new Date}onTouchEnd(t){let e=null;const s=t.changedTouches[0],i=s.pageX-this.startX,n=s.pageY-this.startY;new Date-this.startTime<=this.allowedTime&&(Math.abs(i)>=this.threshold&&Math.abs(n)<=this.restraint?e=i<0?X:I:Math.abs(n)>=this.threshold&&Math.abs(i)<=this.restraint&&(e=n<0?M:$),this.emit(z,e,t))}}Object.assign(G.prototype,Y);const H=G,N=class{constructor(t,e){this.originalWidth=this.width=t,this.originalHeight=this.height=e,this.widthToHeight=t/e}resize(t,e){t/e>this.widthToHeight?(this.width=e*this.widthToHeight,this.height=e):(this.height=t/this.widthToHeight,this.width=t)}getFactor(){return this.width/this.originalWidth}},U={height:320,width:480,originalHeight:320,originalWidth:480,refreshRate:30,position:"absolute"};class B extends _{constructor(t){super(t),Object.keys(U).forEach((e=>{e in t&&(this[e]=t[e])})),this.sprites=this.children,this.sounds=[],this.callbacks=[],this.loadedSpritesIndex=0,this.loadedSoundsIndex=0,this.keyboard=new P,this.touch=new H,this.scaling=new N(this.originalWidth,this.originalHeight),this.scaling.resize(this.width,this.height),this.state=0}render(){return super.render(),Object.assign(this.el.style,{position:this.position,display:"block",overflow:"hidden",height:`${this.scaling.height}px`,width:`${this.scaling.width}px`,fontSize:2*this.scaling.getFactor()+"em"}),this.scenegraph=this.createElement("div",{style:"visibility: hidden;"}),this.el.appendChild(this.scenegraph),this}onDestroy(){this.keyboard.destroy(),this.touch.destroy()}preload(){for(let t=this.sprites.length-1;t>=this.loadedSpritesIndex;t--)this.sprites[t].load();for(let t=this.sounds.length-1;t>=this.loadedSoundsIndex;t--)this.sounds[t].load();this.waitForResources()}waitForResources(){let t=0;for(let e=this.loadedSpritesIndex;e<this.sprites.length;e++)this.sprites[e].isReady()&&t++;let e=0;for(let t=this.loadedSoundsIndex;t<this.sounds.length;t++)this.sounds[t].isReady()&&e++;const s=this.sprites.length+this.sounds.length-this.loadedSpritesIndex-this.loadedSoundsIndex;if("function"==typeof this.onLoadProgress){let i=(t+e)/s*100;this.onLoadProgress(i)}t+e<s?setTimeout(this.waitForResources.bind(this),100):(this.loadedSpritesIndex=this.sprites.length,this.loadedSoundsIndex=this.sounds.length,0===this.state&&setInterval(this.refresh.bind(this),this.refreshRate),this.state=1,"function"==typeof this._onReadyCallback&&(this._onReadyCallback(),this._onReadyCallback=null),this.scenegraph.style.visibility="visible")}addSprite(t){return this.scenegraph.appendChild(this.addChild(t).el),1===this.state?t.load().then((()=>(this.loadedSpritesIndex++,Promise.resolve()))):Promise.resolve()}addSound(t){return this.sounds.push(t),1===this.state?t.load().then((()=>(this.loadedSoundsIndex++,Promise.resolve()))):Promise.resolve()}addCallback(t,e=this.refreshRate){this.callbacks.push({fn:t,refreshRate:this.normalizeRefrashRate(e),idleCounter:0})}refresh(){if(1===this.state){this.sprites.forEach((t=>{t.refresh()}));for(var t=[],e=this.callbacks.length-1;e>=0;e--){if(this.callbacks[e].idleCounter===this.callbacks[e].refreshRate-1){const s=this.callbacks[e].fn();"boolean"==typeof s?s&&t.push(e):"number"==typeof s&&(this.callbacks[e].refreshRate=this.normalizeRefrashRate(s),this.callbacks[e].idleCounter=0)}this.callbacks[e].idleCounter=(this.callbacks[e].idleCounter+1)%this.callbacks[e].refreshRate}for(e=t.length-1;e>=0;e--)this.callbacks.splice(t[e],1)}}clear(t){this.destroyChildren(),this.loadedSpritesIndex=0,this.sounds=[],this.loadedSoundsIndex=0,t&&(this.callbacks=[]),this.scenegraph.innerHTML=""}muteSound(t){for(var e=this.sounds.length-1;e>=0;e--)this.sounds[e].mute(t)}start(t){"function"==typeof t&&(this._onReadyCallback=t),this.preload()}pause(){this.state=2,this.scenegraph.style.visibility="hidden"}resume(t){2===this.state&&("function"==typeof t&&(this._onReadyCallback=t),this.preload())}normalizeRefrashRate(t){return Math.round(t/this.refreshRate)||1}}Object.assign(B.prototype,U);const W=B;let V,q;const K=class{constructor(t){if(!V){const t=window.AudioContext||window.webkitAudioContext;V=new t,q=V.createGain(),q.connect(V.destination)}this.url=t}load(){fetch(this.url).then((t=>t.arrayBuffer())).then((t=>(t=>new Promise(((e,s)=>{V.decodeAudioData(t,e,s)})))(t))).then((t=>(this.audioBuffer=t,Promise.resolve(t))))}play(){"suspended"===V.state&&V.resume();const t=V.createBufferSource();t.buffer=this.audioBuffer,t.connect(q),t.start()}mute(t){this.muted=!1!==t,this.muted?q.gain.setValueAtTime(0,V.currentTime):q.gain.setValueAtTime(1,V.currentTime)}isReady(){return!!this.audioBuffer}},J=class{constructor(t){this.soundEnabled=!!t.soundEnabled,this.soundEnabled&&(this.sounds={intro:new K("audio/intro.mp3"),back:new K("audio/back.mp3"),dot:new K("audio/dot.mp3"),eaten:new K("audio/eaten.mp3"),eat:new K("audio/eat.mp3"),frightened:new K("audio/frightened.mp3"),dead:new K("audio/dead.mp3"),bonus:new K("audio/bonus.mp3"),life:new K("audio/life.mp3")},Object.keys(this.sounds).forEach((e=>{t.addSound(this.sounds[e])})))}play(t){this.soundEnabled&&this.sounds[t].play()}},Q=class{constructor(t,e,s,i){this.code=t,this.col=e,this.row=s,this.map=i,this.width=32,this.height=32,this.x=this.col*this.width+this.width/2,this.y=this.row*this.height+this.height/2+4}isWall(){return"="===this.code}isHouse(){return"h"===this.code}isTunnel(){return"t"===this.code}hasDot(){return this.item&&"."===this.code}hasPill(){return this.item&&"*"===this.code}get(t){return"u"===t?this.getU():"d"===t?this.getD():"l"===t?this.getL():"r"===t?this.getR():null}getU(){return this.map.getTile(this.col,this.row-1)||null}getD(){return this.map.getTile(this.col,this.row+1)||null}getL(){return this.map.getTile(this.col-1,this.row)||null}getR(){return this.map.getTile(this.col+1,this.row)||null}},Z=class{constructor(t){this.tiles=[],this.width=t[0].length,this.height=t.length,this.tunnels=[];for(var e=0;e<this.height;e++)for(var s=t[e],i=0;i<this.width;i++){var n=s.charAt(i),h=new Q(n,i,e,this);this.tiles.push(h),h.isHouse()&&!this.house&&(this.house=h),!h.isTunnel()||0!==h.col&&h.col!==this.width-1||this.tunnels.push(h)}this.houseCenter=this.house.getD().getD(),this.tileWidth=this.tiles[0].width,this.tileHeight=this.tiles[0].height}getTile(t,e,s){s&&(t=parseInt(t/this.tileWidth),e=parseInt(e/this.tileHeight)),t>this.width-1&&(t=0),t<0&&(t=this.width-1),e>this.height-1&&(e=0),e<0&&(e=this.height-1);var i=e*this.width+t;return this.tiles[i]||null}destroyItems(){for(var t=this.tiles.length;t--;){var e=this.tiles[t];e.item&&e.item.destroy()}}hideItems(){for(var t=this.tiles.length;t--;){var e=this.tiles[t];e.item&&e.item.hide()}}},tt=class extends v{constructor(t){super(t)}fetch(){if(this.url&&window.localStorage){const t=window.localStorage.getItem(this.url);t&&this.set(JSON.parse(t))}}save(){this.url&&window.localStorage&&window.localStorage.setItem(this.url,JSON.stringify(this))}},et=()=>(new Date).getTime(),st=class{constructor(t){this.time=t,this.start=et()}pause(){this.pauseTime=et()}resume(){this.start+=et()-this.pauseTime}getElapsed(){return et()-this.start}isElapsed(t=this.time){return this.getElapsed()>1e3*t}},it={imageURL:null,numberOfFrame:1,delta:0,refreshRate:30,type:0,offsetX:0,offsetY:0};class nt{constructor(t){Object.keys(it).forEach((e=>{e in t&&(this[e]=t[e])}))}load(){return this.img=new Image,this.img.src=this.imageURL,new Promise(((t,e)=>{this.img.addEventListener("load",t)}))}isReady(){return this.img.complete}}Object.assign(nt.prototype,it);const ht=nt,at={width:32,height:32,x:0,y:0,z:0,offsetX:0,offsetY:0,idleCounter:0,currentFrame:0,frameIncrement:1,angle:0,factor:1,playing:!0,factorH:1,factorV:1,animations:{},defaultAnimation:"default",normalizeRefrashRate:null,type:null};class rt extends _{constructor(t){super(t),Object.keys(at).forEach((e=>{e in t&&(this[e]=t[e])}))}load(){return Promise.all(Object.keys(this.animations).map((t=>this.animations[t].load())))}isReady(){return Object.keys(this.animations).some((t=>!!this.animations[t].isReady()))}render(){Object.assign(this.el.style,{position:"absolute",overflow:"hidden",height:`${this.height}px`,width:`${this.width}px`,zIndex:this.z}),this.setAnimation(this.animations[this.defaultAnimation]),this.transform()}refresh(){if(this.animation){if(this.idleCounter===this.normalizeRefrashRate(this.animation.refreshRate)-1&&this.playing&&(4&this.animation.type?this.currentFrame<this.animation.numberOfFrame-1?this.currentFrame+=this.frameIncrement:this.currentFrame==this.animation.numberOfFrame-1&&8&this.animation.type&&"function"==typeof this.callback&&(this.callback(this),this.callback=null):(32&this.animation.type&&(this.currentFrame===this.animation.numberOfFrame-1&&1===this.frameIncrement?this.frameIncrement=-1:0===this.currentFrame&&-1===this.frameIncrement&&(this.frameIncrement=1)),this.currentFrame=(this.currentFrame+this.frameIncrement)%this.animation.numberOfFrame,0===this.currentFrame&&8&this.animation.type&&"function"==typeof this.callback&&this.callback(this)),this.animation.numberOfFrame>1)){let t=0,e=0;1&this.animation.type?(t=-this.animation.offsetX,e=-this.animation.offsetY-this.animation.delta*this.currentFrame):2&this.animation.type&&(t=-this.animation.offsetX-this.animation.delta*this.currentFrame,e=-this.animation.offsetY),this.el.style.backgroundPosition=`${t}px ${e}px`}this.idleCounter=(this.idleCounter+1)%this.normalizeRefrashRate(this.animation.refreshRate)}}pauseAnimation(){this.playing=!1}resumeAnimation(){this.playing=!0}setAnimation(t,e,s){this.animation=t,this.currentFrame=0,this.frameIncrement=1,this.el.style.backgroundImage=`url('${t.imageURL}')`,1&t.type?this.el.style.backgroundRepeat="repeat-x":2&t.type?this.el.style.backgroundRepeat="repeat-y":this.el.style.backgroundRepeat="no-repeat",this.el.style.backgroundPosition=`${-0-t.offsetX}px ${-0-t.offsetY}px`,"function"==typeof s&&(this.callback=s)}transform(){this.el.style.transform=`translate(${this.x*this.factor-this.offsetX}px, ${this.y*this.factor-this.offsetY}px) rotate(${this.angle}deg) scale(${this.factor*this.factorH}, ${this.factor*this.factorV})`}rotate(t,e){!0===e&&(t+=this.angle,t%=360),this.angle=parseFloat(t),this.transform()}scale(t,e){!0===e&&(t*=this.factor),this.factor=parseFloat(t),this.transform()}flipH(t){if(void 0===t)return void 0!==this.factorH&&-1===this.factorH;this.factorH=t?-1:1,this.transform()}flipV(t){if(void 0===t)return void 0!==this.factorV&&-1===this.factorV;this.factorV=t?-1:1,this.transform()}setXYZ(t,e){let s=!1;Object.keys(t).forEach((i=>{switch(i){case"x":e&&(t.x+=this.x),this.x=t.x,s=!0;break;case"y":e&&(t.y+=this.y),this.y=t.y,s=!0;break;case"z":e&&(t.z+=this.z),this.z=t.z,this.el.style.zIndex=this.z}})),s&&this.transform()}setWH(t,e){Object.keys(t).forEach((s=>{switch(s){case"w":e&&(t.w+=this.width),this.width=t.w,this.el.style.width=`${this.width}px`;break;case"h":e&&(t.h+=this.height),this.height=t.h,this.el.style.height=`${this.height}px`}}))}}Object.assign(rt.prototype,at);const ot=rt,dt=class extends ot{constructor(t={}){super(t),t.map&&(this.map=t.map),this.offsetX=parseInt(this.width/2),this.offsetY=parseInt(this.height/2),this.render()}getTile(){return this.map.getTile(this.x,this.y,!0)}destroy(){super.destroy().removeElement()}hide(){this.el.style.display="none"}show(){this.el.style.display=""}},lt={width:60,height:60,step:10,speed:80,dir:null,preturn:!1},ct={l:"left",r:"right",u:"up",d:"down"},ut={l:"r",r:"l",u:"d",d:"u"};class mt extends dt{constructor(t){super(t),Object.keys(lt).forEach((e=>{e in t&&(this[e]=t[e])})),this.pauseAnimation(),this.on("item:tile",(t=>{this.setNextAnimation()})),this._moving=!1,this._lastX=this.x,this._lastY=this.y,this._speed=this.speed,this._dir=null,this._nextAnimation=null,this._nextDirection=null,this._moving=!1,this._saveDefaults()}_saveDefaults(){this._defaults={},["x","y","_lastX","_lastY","dir","_dir","_nextAnimation","_nextDirection","_moving","mode","animation"].forEach((t=>{this._defaults[t]=this[t]}))}reset(){Object.assign(this,this._defaults),this.transform(),this.setAnimation(this.animation),this.pauseAnimation()}update(){var t=this.getTile();Math.abs(this.y-t.y)<1&&(this.y=t.y),Math.abs(this.x-t.x)<1&&(this.x=t.x),this._lastX!==this.x||this._lastY!=this.y?(this.setXYZ({x:this.x,y:this.y}),this._lastX=this.x,this._lastY=this.y,this._moving||(this.emit("item:move"),this.resumeAnimation(),this._moving=!0),this.emit("item:position",this._getPositionData())):this._moving&&(this.emit("item:stop"),this.pauseAnimation(),this._moving=!1),this._nextAnimation&&this.animation!==this._nextAnimation&&this.setAnimation(this._nextAnimation)}_getPositionData(){return{x:this.x,y:this.y,tile:this.getTile(),dir:this.dir}}move(t){if(t||(t=this.dir),t){var e,s=this.getTile(),i=this.getStep();if((t!=this.dir||this._preturn)&&this.canGo(t)){if((t!==this.dir&&t!==this._getOpDirection()||this._preturn)&&!this._isCentered()){if(this._isV(t)){var n=Math.abs(this.x-s.x);this.preturn?this._isCentered("x")?this._preturn=!1:(this.x>s.x?this.x-=this.getMin(n,i):this.x+=this.getMin(n,i),this._preturn=!0):e=this.getMin(n,i)}if(this._isH(t)){var h=Math.abs(this.y-s.y);this.preturn?this._isCentered("y")?this._preturn=!1:(this.y>s.y?this.y-=this.getMin(h,i):this.y+=this.getMin(h,i),this._preturn=!0):e=this.getMin(h,i)}}e||(this.dir=t,this.setNextAnimation())}e||(this.canGo(this.dir)?e=i:(this._isV(this.dir)&&(e=this.getMin(Math.abs(this.y-s.y),i)),this._isH(this.dir)&&(e=this.getMin(Math.abs(this.x-s.x),i)))),e&&("u"===this.dir&&(this.y-=e),"r"===this.dir&&(this.x+=e),"d"===this.dir&&(this.y+=e),"l"===this.dir&&(this.x-=e)),this.x<0&&(this.x=this.map.width*this.map.tileWidth),this.x>this.map.width*this.map.tileWidth&&(this.x=0),this.y<0&&(this.y=this.map.height*this.map.tileHeight),this.y>this.map.height*this.map.tileHeight&&(this.y=0),(s=this.getTile())!==this._lastTile&&(this._lastTile=s,this.emit("item:tile",s)),this.update()}}getStep(){return this.step*(this._speed/100)}setNextAnimation(){this._nextAnimation=this.animations[ct[this.dir]]}_getOpDirection(t){return ut[t||this.dir]}canGo(t){const e=this.getTile().get(t);return e&&!e.isHouse()&&!e.isWall()}_isV(t){return"u"===t||"d"===t}_isH(t){return"l"===t||"r"===t}_isCentered(t){var e=this.getTile(),s=e.x===this.x,i=e.y===this.y;return"x"===t?s:("y"===t||s)&&i}getMin(){for(var t=null,e=0,s=arguments.length;e<s;e++)(null===t||arguments[e]<t)&&(t=arguments[e]);return t}}Object.assign(mt.prototype,lt);const pt=mt,gt=(t,e)=>{const s=t.x,i=e.x,n=t.y,h=e.y;return Math.sqrt(Math.pow(s-i,2)+Math.pow(n-h,2))},ft="scatter",yt="chase",bt="frightened",vt="house",wt="dead",_t={imageURL:"img/characters.png",numberOfFrame:2,delta:64,refreshRate:180,type:2},Et={frightened:new ht({..._t,offsetY:376,offsetX:-2}),frightenedBlink:new ht({..._t,offsetY:376,offsetX:-2,numberOfFrame:4}),deadRight:new ht({..._t,offsetY:376,offsetX:254,numberOfFrame:1}),deadDown:new ht({..._t,offsetY:376,offsetX:318,numberOfFrame:1}),deadUp:new ht({..._t,offsetY:376,offsetX:382,numberOfFrame:1}),deadLeft:new ht({..._t,offsetY:376,offsetX:446,numberOfFrame:1}),score200:new ht({..._t,imageURL:"img/misc.png",numberOfFrame:1,offsetX:-2,offsetY:110}),score400:new ht({..._t,imageURL:"img/misc.png",numberOfFrame:1,offsetX:62,offsetY:110}),score800:new ht({..._t,imageURL:"img/misc.png",numberOfFrame:1,offsetX:126,offsetY:110}),score1600:new ht({..._t,imageURL:"img/misc.png",numberOfFrame:1,offsetX:192,offsetY:110})},xt={animations:Et,width:64,speed:75,frightenedTime:5,waitTime:4,scatterTarget:0,mode:vt,score:"200",scores:{200:"400",400:"800",800:"1600"},blinky:null,getChaseTarget:function(){return this.pacmanData.tile},tunnelSpeed:null,frightenedSpeed:null,frightenedFlashes:null};class Tt extends pt{constructor(t){super(t),Object.keys(xt).forEach((e=>{e in t&&(this[e]=t[e])}));const{addGameGlobalModeEventListener:e,addGameGhostEatenEventListener:s,addPacmanEatPillEventListener:i,addPacmanPositionEventListener:n}=t;this.deadTarget=this.map.house.getR().getU(),this.deadEndX=this._defaults.x,this.deadEndY=this.map.houseCenter.y,this.deadEnd=this.map.getTile(this.deadEndX,this.deadEndY,!0),this.houseTop=this.y-this.getTile().height/2,this.houseBottom=this.y+this.getTile().height/2,this.houseExitTile=this.map.house.getR(),this.houseExitTileX=this.houseExitTile.x-this.map.tileWidth/2,this.scatterTarget=this.map.tiles[this.scatterTarget],this.setMode(this.mode),this.on("item:tile",(t=>{this.mode===bt?this._speed=this.frightenedSpeed:this.mode===wt?this._speed=130:t.isTunnel()?this._speed=this.tunnelSpeed:this._speed=this.speed,this._turnBack?(this.dir=this._getOpDirection(this.dir),this._dir=null,this._nextDir=this.getNextDirection(),this._turnBack=!1):(this._dir=this._nextDir,this._nextDir=this.getNextDirection()),this._eatEvent=!1})),e(this.onGameGlobalMode.bind(this)),i((()=>{this.setMode(bt),this.score=200})),s((()=>{this.score=this.scores[this.score]})),n((t=>{this.pacmanData=t}))}reset(){super.reset(),this.setMode(this.mode)}pause(){this.houseTimer&&this.houseTimer.pause(),this.frightenedTimer&&this.frightenedTimer.pause()}resume(){this.mode===bt&&this.frightenedTimer.resume(),this.mode!==vt||this.housePrepareExit||this.houseTimer.resume()}setMode(t){if(!t){if(this.frightened)return this.mode=this.frightened,void(this.frightened=null);t=this.globalMode}t!==bt||this.mode!==vt&&this.mode!==wt?this.mode=t:this.frightened=t,this.onEnterMode(t)}shouldExitMode(){return this.mode===wt?this.getTile()===this.deadEnd:this.mode===bt?this.frightenedTimer.isElapsed():this.mode===vt?this.getTile()===this.houseExitTile.getU():this.mode!=this.globalMode}onEnterMode(t){switch(t){case wt:this.emit("item:modefrightened:exit"),this.deadPrepareEnter=!1,this._nextAnimation=this.animations[`score${this.score}`],this.update();break;case bt:this.frightenedTimer=new st(this.frightenedTime),this.emit("item:modefrightened:enter");break;case vt:this.housePrepareExit=!1,this._speed=70}}onExitMode(){const t=this.getTile();switch(this.mode){case wt:this.reset();break;case bt:this.setMode(),this.emit("item:modefrightened:exit");break;case vt:this.houseTimer=null,this._dir="l",this._nextDir="l",this._lastTile=t.getD(),this._speed=this.speed,this.setMode();break;default:t.isHouse()||(this._turnBack=!0),this.setMode()}}isFrightened(){return this.frightened||this.mode===bt}isDead(){return this.mode===wt}onGameGlobalMode(t){t&&(this.globalMode=t)}move(){if(this.shouldExitMode())this.onExitMode();else if(this.mode===wt)if(this.deadPrepareEnter||this.getTile()!==this.deadTarget||(this.deadPrepareEnter=!0),this.deadPrepareEnter){let t=this.deadEndX,e=this.deadEndY;this.y<e&&(t=this.deadTarget.x-this.map.tw/2),this.x<t?this.dir="r":this.x>t?this.dir="l":this.y<e&&(this.dir="d"),"d"===this.dir&&(this.y+=this.getMin(this.getStep(),e-this.y)),"r"===this.dir&&(this.x+=this.getMin(this.getStep(),t-this.x)),"l"===this.dir&&(this.x-=this.getMin(this.getStep(),this.x-t)),this.setNextAnimation(),this.update()}else super.move(this._dir);else if(this.mode===vt){this.houseTimer||(this.houseTimer=new st(this.waitTime));const t=this.getTile();this.housePrepareExit||!this.houseTimer.isElapsed()||t.isWall()||(this.housePrepareExit=!0,this.y=t.y),this.frightened&&this.frightenedTimer.isElapsed()&&(this.frightened=null),this.housePrepareExit?(this.x<this.houseExitTileX?this.dir="r":this.x>this.houseExitTileX?this.dir="l":this.dir="u","u"===this.dir&&(this.y-=this.getMin(this.getStep(),this.y-this.houseExitTile.getU().y)),"r"===this.dir&&(this.x+=this.getMin(this.getStep(),this.houseExitTileX-this.x)),"l"===this.dir&&(this.x-=this.getMin(this.getStep(),this.x-this.houseExitTileX))):(this.y<=this.houseTop&&"u"===this.dir&&(this.dir="d"),this.y>=this.houseBottom&&"d"===this.dir&&(this.dir="u"),"u"===this.dir&&(this.y-=this.getMin(this.getStep(),this.y-this.houseTop)),"d"===this.dir&&(this.y+=this.getMin(this.getStep(),this.houseBottom-this.y))),this.setNextAnimation(),this.update()}else super.move(this._dir);if(!this._eatEvent){var t=this.pacmanData.tile,e=this.getTile(),s=this._getOpDirection(this.dir);(t===e||this.pacmanData.dir===s&&t===e.get(s))&&(this._eatEvent=!0,this.mode===bt?(this.setMode(wt),this.emit("item:eaten")):this.mode!==wt&&this.emit("item:eat"))}}canGo(t,e){e||(e=this.getTile());const s=e.get(t);return this.mode===wt?!s||!s.isWall():!!s&&!s.isWall()&&!s.isHouse()}getNextDirection(){if(this.mode===bt){const t=this.getTile().get(this._dir),e=["u","r","d","l","u","r","d","l"];let s=Math.floor(4*Math.random()),i=e[s];for(;i&&(i===this._getOpDirection(this._dir)||!this.canGo(i,t));)i=e[++s];return i}const t=this.mode===yt?this.getChaseTarget():this.mode===ft?this.scatterTarget:this.deadTarget,e=this._dir||this.dir,s=this.getTile().get(e),i=["u","l","d","r"];let n,h;for(var a=0;a<4;a++){let r=i[a];if(r!==this._getOpDirection(e)&&this.canGo(r,s)){let e=s.get(r),i=gt(e,t);(void 0===h||h>i)&&(n=r,h=i)}}return n}setNextAnimation(){if(this.mode===wt)switch(this.dir){case"u":this._nextAnimation=this.animations.deadUp;break;case"r":this._nextAnimation=this.animations.deadRight;break;case"d":this._nextAnimation=this.animations.deadDown;break;case"l":this._nextAnimation=this.animations.deadLeft}else this.mode===bt||this.mode===vt&&this.frightened?this.frightenedTimer.isElapsed(.75*this.frightenedTime)?this._nextAnimation=this.animations.frightenedBlink:this._nextAnimation=this.animations.frightened:super.setNextAnimation()}}Object.assign(Tt.prototype,xt);const kt=Tt,St=["----------------------------","----------------------------","----------------------------","============================","=......==..........==......=","=*====.==.========.==.====*=","=.====.==.========.==.====.=","=..........................=","===.==.=====.==.=====.==.===","--=.==.=====.==.=====.==.=--","===.==.=====.==.=====.==.===","ttt.==.......==.......==.ttt","===.=====-========-=====.===","--=.=====-========-=====.=--","--=.--------------------.=--","--=.=====-===hh===-=====.=--","--=.=====-===--===-=====.=--","--=.==----=------=----==.=--","--=.==-==-========-==-==.=--","===.==-==-========-==-==.===","ttt.---==----------==---.ttt","===.========-==-========.===","--=.========-==-========.=--","--=.......---==---.......=--","--=.=====.========.=====.=--","===.=====.========.=====.===","=............--............=","=.====.=====.==.=====.====.=","=.====.=====.==.=====.====.=","=.====.==....==....==.====.=","=*====.==.========.==.====*=","=.====.==.========.==.====.=","=..........................=","============================","----------------------------","----------------------------"],Rt=["----------------------------","----------------------------","----------------------------","============================","tttttt-==..........==-tttttt","======.==.========.==.======","======.==.========.==.======","=*...........==...........*=","=.=======.==.==.==.=======.=","=.=======.==.==.==.=======.=","=.==......==.==.==......==.=","=.==.====-==....==-====.==.=","=.==.====-========-====.==.=","=......==-========-==......=","======.==----------==.======","======.==-===hh===-==.======","=......==-===--===-==......=","=.====.==-=------=-==.====.=","=.====.---========---.====.=","=...==.==-========-==.==...=","===.==.==----------==.==.===","--=.==.====-====-====.==.=--","--=.==.====-====-====.==.=--","--=.........====.........=--","--=.=======.====.=======.=--","===.=======.====.=======.===","ttt....==...----...==....ttt","===.==.==.========.==.==.===","===.==.==.========.==.==.===","=*..==.......==.......==..*=","=.====.=====.==.=====.====.=","=.====.=====.==.=====.====.=","=..........................=","============================","----------------------------","----------------------------"],Ft=["----------------------------","----------------------------","----------------------------","============================","=.........==....==.........=","=.=======.==.==.==.=======.=","=*=======.==.==.==.=======*=","=.==.........==.........==.=","=.==.==.====.==.====.==.==.=","=....==.====.==.====.==....=","====.==.====.==.====.==.====","====.==..............==.====","t....====-========-====....t","=.==-====-========-====-==.=","=.==--------------------==.=","=.====-==-===hh===-==-====.=","=.====-==-===--===-==-====.=","=.-----==-=------=-==-----.=","=.==-====-========-====-==.=","=.==-====-========-====-==.=","=.==--------------------==.=","=.====-=====-==-=====-====.=","=.====-=====-==-=====-====.=","=......==....==....==......=","===.==.==.========.==.==.===","===.==.==.========.==.==.===","=*..==.......--.......==..*=","=.====.=====.==.=====.====.=","=.====.=====.==.=====.====.=","=......==....==....==......=","=.====.==.========.==.====.=","=.====.==.========.==.====.=","=......==..........==......=","============================","----------------------------","----------------------------"],Ot=["----------------------------","----------------------------","----------------------------","============================","=..........................=","=.==.====.========.====.==.=","=*==.====.========.====.==*=","=.==.====.==....==.====.==.=","=.==......==.==.==......==.=","=.====.==.==.==.==.==.====.=","=.====.==.==.==.==.==.====.=","=......==....==....==......=","===.========-==-========.===","--=.========-==-========.=--","--=....==----------==....=--","===-==.==-===hh===-==.==-===","ttt-==.==-===--===-==.==-ttt","======.---=------=---.======","======.==-========-==.======","ttt-==.==-========-==.==-ttt","===-==.==----------==.==-===","--=....=====-==-=====....=--","--=.==.=====-==-=====.==.=--","--=.==....---==---....==.=--","--=.=====.==-==-==.=====.=--","===.=====.==-==-==.=====.===","=.........==----==.........=","=.====.==.========.==.====.=","=.====.==.========.==.====.=","=.==...==..........==...==.=","=*==.=======.==.=======.==*=","=.==.=======.==.=======.==.=","=............==............=","============================","----------------------------","----------------------------"],Lt=[{mode:ft,time:7},{mode:yt,time:20},{mode:ft,time:7},{mode:yt,time:20},{mode:ft,time:5},{mode:yt,time:20},{mode:ft,time:5},{mode:yt,time:1e6}];var Dt=[[Lt,0,100,80,71,75,40,20,80,10,85,90,79,50,6,5,St,"maze-1"],[Lt,1,200,90,79,85,45,30,90,15,95,95,83,55,5,5,St,"maze-1"],[Lt,2,500,90,79,85,45,40,90,20,95,95,83,55,4,5,Rt,"maze-2"],[Lt,3,500,90,79,85,45,40,90,20,95,95,83,55,3,5,Rt,"maze-2"],[Lt,4,700,100,87,95,50,40,100,20,105,100,87,60,2,5,Rt,"maze-2"],[Lt,5,700,100,87,95,50,50,100,25,105,100,87,60,5,5,Ft,"maze-3"],[Lt,6,1e3,100,87,95,50,50,100,25,105,100,87,60,2,5,Ft,"maze-3"],[Lt,7,1e3,100,87,95,50,50,100,25,105,100,87,60,2,5,Ft,"maze-3"],[Lt,0,2e3,100,87,95,50,60,100,30,105,100,87,60,1,3,Ft,"maze-3"],[Lt,1,2e3,100,87,95,50,60,100,30,105,100,87,60,5,5,Ot,"maze-4"],[Lt,2,2e3,100,87,95,50,60,100,30,105,100,87,60,2,5,Ot,"maze-4"],[Lt,3,2e3,100,87,95,50,80,100,40,105,100,87,60,1,3,Ot,"maze-4"],[Lt,4,5e3,100,87,95,50,80,100,40,105,100,87,60,1,3,Ot,"maze-4"],[Lt,5,5e3,100,87,95,50,80,100,40,105,100,87,60,3,5,Ft,"maze-3"],[Lt,6,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,Ft,"maze-3"],[Lt,7,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,Ft,"maze-3"],[Lt,7,5e3,100,87,95,50,100,100,50,105,0,0,0,0,0,Ft,"maze-3"],[Lt,7,5e3,100,87,95,50,100,100,50,105,100,87,60,1,3,Ot,"maze-4"],[Lt,7,5e3,100,87,95,50,120,100,60,105,0,0,0,0,0,Ot,"maze-4"],[Lt,7,5e3,100,87,95,50,120,100,60,105,0,0,0,0,0,Ot,"maze-4"],[Lt,7,5e3,90,79,95,50,120,100,60,105,0,0,0,0,0,Ot,"maze-4"]],jt=["game.times","game.bonusIndex","game.bonusScore","pacman.speed","pacman.dotSpeed","ghost.speed","ghost.tunnelSpeed","","","","","pacman.frightenedSpeed","pacman.frightenedDotSpeed","ghost.frightenedSpeed","ghost.frightenedTime","ghost.frightenedFlashes","game.map","game.maze"];const At=class extends tt{constructor(t){super({level:1,score:0,highScore:0,lives:3,extraLives:1,extraLifeScore:1e4,mode:null,...t}),this.url="jsPacman",this.on("change:score",this.onChangeScore.bind(this))}addScore(t){this.score=this.score+t}updateMode(){this.mode||(this.modeTimer=new st);const{times:t}=this.getSettings("game");let e=0,s=0;for(;t[s];){if(e+=t[s].time,!this.modeTimer.isElapsed(e)||s===t.length-1){this.mode=t[s].mode;break}s++}}pause(){this.modeTimer&&this.modeTimer.pause()}resume(){this.modeTimer&&this.modeTimer.resume()}getSettings(t){const e={},s=this.level>Dt.length?Dt.length:this.level;let i=jt.length;for(;i--;){let n=jt[i].split(".");n[0]===t&&(e[n[1]]=Dt[s-1][i])}return e}onChangeScore(){this.extraLives&&this.score>=this.extraLifeScore&&(this.extraLives--,this.lives++),this.highScore<this.score&&(this.highScore=this.score)}toJSON(){return{highScore:this.highScore}}},Ct=(t,e)=>("pinky"===t&&(e=Object.assign({type:"SPRITE_PINKY",dir:"d",defaultAnimation:"down",getChaseTarget:function(){var t=this.pacmanData.tile,e=this.pacmanData.dir;return t.get(e).get(e).get(e).get(e)},animations:{...Et,right:new ht({..._t,offsetY:252,offsetX:-2}),down:new ht({..._t,offsetY:252,offsetX:126}),up:new ht({..._t,offsetY:252,offsetX:254}),left:new ht({..._t,offsetY:252,offsetX:382})}},e)),"blinky"===t&&(e=Object.assign({type:"SPRITE_BLINKY",dir:"l",waitTime:0,scatterTarget:25,defaultAnimation:"left",animations:{...Et,right:new ht({..._t,offsetY:124,offsetX:-2}),down:new ht({..._t,offsetY:124,offsetX:126}),up:new ht({..._t,offsetY:124,offsetX:254}),left:new ht({..._t,offsetY:124,offsetX:382})}},e)),"inky"===t&&(e=Object.assign({type:"SPRITE_INKY",dir:"u",waitTime:6,scatterTarget:979,defaultAnimation:"up",getChaseTarget:function(){var t=this.pacmanData.tile,e=this.blinky.getTile(),s=this.pacmanData.dir;return t=t.get(s).get(s),this.map.getTile(t.col+t.col-e.col,t.row+t.row-e.row)},animations:{...Et,right:new ht({..._t,offsetY:316,offsetX:-2}),down:new ht({..._t,offsetY:316,offsetX:126}),up:new ht({..._t,offsetY:316,offsetX:254}),left:new ht({..._t,offsetY:316,offsetX:382})}},e)),"sue"===t&&(e=Object.assign({type:"SPRITE_SUE",dir:"u",waitTime:8,scatterTarget:953,defaultAnimation:"up",getChaseTarget:function(){var t=this.pacmanData.tile;return gt(t,this.getTile())>16*t.w?t:this.scatterTarget},animations:{...Et,right:new ht({..._t,offsetY:188,offsetX:-2}),down:new ht({..._t,offsetY:188,offsetX:126}),up:new ht({..._t,offsetY:188,offsetX:254}),left:new ht({..._t,offsetY:188,offsetX:382})}},e)),new kt(e)),Pt={imageURL:"img/pills.png",numberOfFrame:1},zt=t=>new dt({width:8,height:8,defaultAnimation:"white",animations:{white:new ht({...Pt,offsetX:24}),yellow:new ht({...Pt,offsetX:56}),red:new ht({...Pt,offsetX:88})},...t}),Mt={imageURL:"img/pills.png",numberOfFrame:2,delta:24,refreshRate:450,type:1},It=t=>new dt({width:24,height:24,animations:{white:new ht({...Mt}),yellow:new ht({...Mt,offsetX:32}),red:new ht({...Mt,offsetX:64})},...t}),$t={imageURL:"img/misc.png",offsetY:0,offsetX:0},Xt={default:new ht({...$t}),score100:new ht({...$t,offsetY:60}),score200:new ht({...$t,offsetX:60,offsetY:60}),score500:new ht({...$t,offsetX:120,offsetY:60}),score700:new ht({...$t,offsetX:180,offsetY:60}),score1000:new ht({...$t,offsetX:240,offsetY:60}),score2000:new ht({...$t,offsetX:300,offsetY:60}),score5000:new ht({...$t,offsetX:360,offsetY:60})},Yt={animations:Xt,speed:40,score:"100"};class Gt extends pt{constructor(t){super(t),Object.keys(Yt).forEach((e=>{e in t&&(this[e]=t[e])}));const{addPacmanPositionEventListener:e}=t;this.on("item:tile",(t=>{this._dir=this._nextDir,this._nextDir=this.getNextDirection(),this._eatEvent=!1,this.getTile()===this._getTarget()&&(this._targetFound?this._targetFound--:this.emit("item:destroy"))})),e((t=>{this.pacmanData=t})),this._targetFound=2}move(){if(pt.prototype.move.call(this,this._dir),!this._eatEvent){var t=this.pacmanData.tile,e=this.getTile(),s=this._getOpDirection(this._dir);(t===e||this.pacmanData.dir===s&&t===e.get(s))&&(this._eatEvent=!0,this._nextAnimation=this.animations[`score${this.score}`],this.update(),this.emit("item:eaten",this))}}getNextDirection(){for(var t,e,s=this._getTarget(),i=this._dir||this.dir,n=this.getTile().get(i),h=["u","l","d","r"],a=0;a<4;a++){var r=h[a];if(r!==this._getOpDirection(i)&&this.canGo(r,n)){var o=n.get(r),d=gt(o,s);(void 0===e||e>d)&&(t=r,e=d)}}return t}canGo(t,e){e||(e=this.getTile());var s=e.get(t);return!!s&&!s.isWall()&&!s.isHouse()}_getTarget(){return this.map.tunnels[0]}setNextAnimation(){}}Object.assign(Gt.prototype,Yt);const Ht=Gt,Nt=(t,e)=>new Ht({animations:{...Xt,default:new ht({...$t,offsetX:60*t})},...e}),Ut={imageURL:"img/characters.png",numberOfFrame:4,delta:64,refreshRate:60,offsetY:60,type:2},Bt={animations:{right:new ht({...Ut}),down:new ht({...Ut,offsetX:256}),up:new ht({...Ut,offsetX:512}),left:new ht({...Ut,offsetX:768})},dir:"l",defaultAnimation:"left",preturn:!0,frightenedSpeed:null,frightenedDotSpeed:null,dotSpeed:null};class Wt extends pt{constructor(t){super(t),Object.keys(Bt).forEach((e=>{e in t&&(this[e]=t[e])}));const{addGameGhostEatEventListener:e,addGameGhostModeFrightenedEnter:s,addGameGhostModeFrightenedExit:i}=t;this._ghostFrightened=[],this.on("item:tile",(t=>{this._ghostFrightened.length?this._speed=this.frightenedSpeed:this._speed=this.speed,t.item&&(t.hasPill()?this.emit("item:eatpill",t):t.hasDot()&&(this.emit("item:eatdot",t),this._ghostFrightened.length?this._speed=this.frightenedDotSpeed:this._speed=this.dotSpeed),t.item.destroy(),t.item=null)})),e((t=>{this._eatenTurns=9,this.dir="r",this.pauseAnimation()})),s((t=>{this._ghostFrightened=this._ghostFrightened.filter((e=>e!==t)).concat([t])})),i((t=>{this._ghostFrightened=this._ghostFrightened.filter((e=>e!==t))}))}reset(){pt.prototype.reset.apply(this),this._lastEatenTurnsTime=null}move(){this._eatenTurns?this._eatenTurnsFrames?this._eatenTurnsFrames--:(9===this._eatenTurns&&this.emit("item:die"),this._eatenTurns>2?(this.dir={d:"l",l:"u",u:"r",r:"d"}[this.dir],this.setNextAnimation(),this.update(),this._eatenTurnsFrames=5):this._eatenTurnsFrames=25,this._eatenTurns--,0===this._eatenTurns&&this.emit("item:life")):pt.prototype.move.apply(this,arguments)}}Object.assign(Wt.prototype,Bt);const Vt=Wt,qt=class{constructor(t){this.pacmans=[],this.model=t.model;for(var e=0;e<5;e++){let s=new Vt({x:t.x+70*e,y:t.y,factor:t.factor,defaultAnimation:"right",addGameGhostEatEventListener:()=>{},addGameGhostModeFrightenedEnter:()=>{},addGameGhostModeFrightenedExit:()=>{},normalizeRefrashRate:()=>1});t.addSprite(s),this.pacmans.push(s),e>this.model.lives-2&&this.pacmans[e].hide()}this.model.on("change:lives",this.render.bind(this))}render(){for(var t=0;t<5;t++)t>this.model.lives-2?this.pacmans[t].hide():this.pacmans[t].show()}},Kt=class{constructor(t){this.bonuses=[],this.x=t.x,this.y=t.y,this.model=t.model;for(var e=0;e<8;e++){let s=Nt(e,{x:t.x-64*e,y:t.y,factor:t.factor,addPacmanPositionEventListener:()=>{},normalizeRefrashRate:()=>1});t.addSprite(s),this.bonuses.push(s),e>=this.model.level&&this.bonuses[e].hide()}this.model.on("change:level",this.render.bind(this))}render(){for(var t=0;t<8;t++)t>=this.model.level?this.bonuses[t].hide():this.bonuses[t].show()}},Jt=t=>{t.style.display=""},Qt=t=>{t.style.display="none"},Zt={width:448,height:576,originalWidth:896,originalHeight:1152,dotScore:10,pillScore:50,defaultLives:3,soundEnabled:!0,events:{"click .start":"startLevel"}};class te extends W{constructor(t={}){super(t),Object.keys(Zt).forEach((e=>{e in t&&(this[e]=t[e])})),this.model=new At({lives:this.defaultLives}),this.model.fetch(),this.render(),this.elements={splash:this.$(".splash"),start:this.$(".start"),startP1:this.$(".start-p1"),startReady:this.$(".start-ready"),highScore:this.$(".high-score span"),score:this.$(".p1-score span"),gameOver:this.$(".game-over"),soundStatus:this.$(".sound-status"),paused:this.$(".paused"),load:this.$(".loadbar")},this.keyboard.on(A,this._onKeyDown.bind(this)),this.touch.on(z,this._onSwipe.bind(this)),this.sound=new J({soundEnabled:this.soundEnabled,addSound:this.addSound.bind(this)}),this.lives=new qt({lives:this.defaultLives+1,x:40,y:1124,model:this.model,factor:this.scaling.getFactor(),addSprite:this.addSprite.bind(this)}),this.bonuses=new Kt({level:this.model.level,x:860,y:1124,model:this.model,factor:this.scaling.getFactor(),addSprite:this.addSprite.bind(this)}),this._onGhostEaten=this._onGhostEaten.bind(this),this._onGhostEat=this._onGhostEat.bind(this),this.model.on("change:score",this._onChangeScore.bind(this)),this.model.on("change:highScore",this._onChangeHighScore.bind(this)),this.model.on("change:lives",this._onChangeLives.bind(this)),this.model.on("change:extraLives",this._onChangeExtraLives.bind(this)),this.model.on("change:mode",this._onChangeMode.bind(this)),this.makeLevel(),this.start((()=>{Qt(this.elements.load),Jt(this.elements.start)}))}startLevel(){return this._win?(this.model.level++,this.reset(),void(this._win=!1)):this._gameOver?(this.model.level=1,this.reset(),this._gameOver=!1,Qt(this.elements.splash),void this.sound.play("intro")):(Qt(this.elements.splash),this.sound.play("intro"),void this.addCallback(this.mainLoop.bind(this)))}reset(){this.model.mode=null,this.pinky.destroy(),this.blinky.destroy(),this.inky.destroy(),this.sue.destroy(),this.pacman.destroy(),this.map.destroyItems(),this.off("game:ghost:eaten",this._onGhostEaten),this.off("game:ghost:eat",this._onGhostEat),this._win||(this.model.lives=this.defaultLives+1,this.model.score=0),this.keyboard.clear(),this._inputDirection=null,this._lastSwipe=null,this.makeLevel()}makeLevel(){Object.assign(this,this.model.getSettings("game")),this.map=new Z(this.map),this.el.classList.remove("maze-1"),this.el.classList.remove("maze-2"),this.el.classList.remove("maze-3"),this.el.classList.remove("maze-4"),this.el.classList.add(this.maze);var t="white";"maze-2"===this.maze&&(t="yellow"),"maze-3"===this.maze&&(t="red"),this._pauseFrames=80,this._destroyBonus=0,this._showBonus=500;for(var e=this.map.tiles.length,s=0;e--;){var i=this.map.tiles[e];if("."===i.code){let e=zt({defaultAnimation:t,map:this.map,factor:this.scaling.getFactor(),normalizeRefrashRate:this.normalizeRefrashRate.bind(this),x:i.x,y:i.y});i.item=e,this.addSprite(e),s++}if("*"===i.code){let e=It({defaultAnimation:t,map:this.map,factor:this.scaling.getFactor(),normalizeRefrashRate:this.normalizeRefrashRate.bind(this),x:i.x,y:i.y});i.item=e,this.addSprite(e),s++}}this.totalItems=s,this.pacman=new Vt({preturn:!0,x:452,y:848,...this.model.getSettings("pacman"),map:this.map,factor:this.scaling.getFactor(),normalizeRefrashRate:this.normalizeRefrashRate.bind(this),addGameGhostEatEventListener:t=>this.on("game:ghost:eat",t),addGameGhostModeFrightenedEnter:t=>this.on("game:ghost:modefrightened:enter",t),addGameGhostModeFrightenedExit:t=>this.on("game:ghost:modefrightened:exit",t)}),this.pacman.on("item:eatpill",(t=>{this._pauseFrames=2,this.model.addScore(this.pillScore),this.totalItems--,0===this.totalItems?this.win():this.sound.play("frightened")})),this.on("game:ghost:eaten",this._onGhostEaten),this.on("game:ghost:eat",this._onGhostEat),this.pacman.on("item:die",(t=>{this.sound.play("eaten")})),this.pacman.on("item:life",(()=>{this.keyboard.clear(),this._inputDirection=null,this._lastSwipe=null,this.model.mode=null,this.pacman.reset(),this.pinky.reset(),this.blinky.reset(),this.inky.reset(),this.sue.reset(),this.bonus&&(this._destroyBonus=0,this._showBonus=250,this.bonus.reset(),this.bonus.hide()),this.showGhosts(),this.model.lives--,this._pacmanEaten=!1,this.model.lives?(Jt(this.elements.startReady),this._start=1,this._pauseFrames=40):this._pauseFrames=120})),this.pacman.on("item:eatdot",(t=>{this.model.addScore(this.dotScore),this.sound.play("dot"),this.totalItems--,0===this.totalItems&&this.win()})),this.addSprite(this.pacman),this.bonus&&this.bonus.destroy();var n=this.map.tunnels[this.map.tunnels.length-1];this.bonus=Nt(this.bonusIndex,{map:this.map,dir:"l",score:this.bonusScore,x:n.x,y:n.y,factor:this.scaling.getFactor(),normalizeRefrashRate:this.normalizeRefrashRate.bind(this),addPacmanPositionEventListener:t=>this.pacman.on("item:position",t)}),this.bonus.on("item:destroy",(t=>{this.bonus.destroy(),this.bonus=null})),this.bonus.on("item:eaten",(t=>{this._showBonus||(this._pauseFrames=5,this._destroyBonus=25,this.model.addScore(parseInt(t.score)),this.sound.play("bonus"))})),this.addSprite(this.bonus);const h={...this.model.getSettings("ghost"),map:this.map,normalizeRefrashRate:this.normalizeRefrashRate.bind(this),factor:this.scaling.getFactor(),addGameGlobalModeEventListener:t=>this.on("game:globalmode",t),addGameGhostEatenEventListener:t=>this.on("game:ghost:eaten",t),addPacmanPositionEventListener:t=>this.pacman.on("item:position",t),addPacmanEatPillEventListener:t=>this.pacman.on("item:eatpill",t)},a=this.map.houseCenter.getR();this.pinky=Ct("pinky",{...h,x:a.x-this.map.tileWidth/2,y:a.y}),this.addEventListenersToGhost(this.pinky),this.addSprite(this.pinky);const r=this.map.house.getU().getR();this.blinky=Ct("blinky",{...h,x:r.x-this.map.tileWidth/2,y:r.y}),this.addEventListenersToGhost(this.blinky),this.addSprite(this.blinky);const o=this.map.houseCenter.getL();this.inky=Ct("inky",{...h,blinky:this.blinky,x:o.x-16,y:o.y}),this.addEventListenersToGhost(this.inky),this.addSprite(this.inky);const d=this.map.houseCenter.getR().getR();this.sue=Ct("sue",{...h,x:d.x+16,y:d.y}),this.addEventListenersToGhost(this.sue),this.addSprite(this.sue),Jt(this.elements.startReady),this._win?(this.bonus.hide(),this._start=1):(Jt(this.elements.startP1),this.hideGhosts(),this.pacman.hide(),this._start=2)}addEventListenersToGhost(t){t.on("item:eat",(()=>this.emit("game:ghost:eat",t))),t.on("item:eaten",(()=>this.emit("game:ghost:eaten",t))),t.on("item:modefrightened:enter",(()=>this.emit("game:ghost:modefrightened:enter",t))),t.on("item:modefrightened:exit",(()=>this.emit("game:ghost:modefrightened:exit",t)))}mainLoop(){if(this._start||this.model.updateMode(),this._inputDirection=this._getInputDirection(),this._pauseFrames)this._pauseFrames--;else{if(2===this._start)return Qt(this.elements.startP1),this.showGhosts(),this.pacman.show(),this.model.lives=this.defaultLives,this._pauseFrames=60,void this._start--;if(1===this._start)return Qt(this.elements.startReady),void this._start--;if(this._win)return void this.startLevel();if(this._gameOver)return Qt(this.elements.gameOver),void Jt(this.elements.splash);this._showPacman&&(this.pacman.show(),this._showPacman=!1),this.pacman.move(this._inputDirection),this._pacmanEaten?this.hideGhosts():(this._soundBackPauseFrames?this._soundBackPauseFrames--:(this._isGhostDead()?this.sound.play("dead"):this._isGhostFrightened()||this.sound.play("back"),this._soundBackPauseFrames=5),this.pinky.move(),this.blinky.move(),this.inky.move(),this.sue.move(),this._destroyBonus?(1===this._destroyBonus&&(this.bonus.destroy(),delete this.bonus),this._destroyBonus--):this.bonus&&(this._showBonus?(1===this._showBonus&&this.bonus.show(),this._showBonus--):this.bonus.move()))}}pause(){super.pause(),this.pinky.pause(),this.blinky.pause(),this.inky.pause(),this.sue.pause(),this.muteSound(!0),this.model.pause(),Jt(this.elements.paused)}resume(){super.resume(),this.pinky.resume(),this.blinky.resume(),this.inky.resume(),this.sue.resume(),this.muteSound(!!this._muted),this.model.resume(),Qt(this.elements.paused)}win(){this._pauseFrames=120,this._win=!0;let t=14;this.addCallback((()=>t?(t--,this.el.classList.toggle("blink"),!1):(this.el.classList.remove("blink"),!0)),8*this.refreshRate),this.hideGhosts(),this.map.hideItems(),this.pacman.pauseAnimation()}hideGhosts(){this.pinky.hide(),this.blinky.hide(),this.inky.hide(),this.sue.hide(),this.bonus&&this.bonus.hide()}showGhosts(){this.pinky.show(),this.blinky.show(),this.inky.show(),this.sue.show(),this.bonus&&!this._showBonus&&this.bonus.show()}_isGhostFrightened(){return this.blinky.isFrightened()||this.inky.isFrightened()||this.pinky.isFrightened()||this.sue.isFrightened()}_isGhostDead(){return this.blinky.isDead()||this.inky.isDead()||this.pinky.isDead()||this.sue.isDead()}_getInputDirection(){const t=this.keyboard.keys;let e=null;return t[38]?e="u":t[39]?e="r":t[40]?e="d":t[37]&&(e="l"),e?this._lastSwipe=null:this._lastSwipe===M?e="u":this._lastSwipe===I?e="r":this._lastSwipe===$?e="d":this._lastSwipe===X&&(e="l"),e}onLoadProgress(t){this.elements.load.querySelector(".inner").style.width=`${t}%`}_onSwipe(t,e){this._lastSwipe=t}_onKeyDown(t){if(83===t.keyCode){if(!this.soundEnabled)return;this._muted=!this._muted,this.muteSound(this._muted);var e=this.elements.soundStatus;this._muted?e.classList.remove("on"):e.classList.add("on"),Jt(e),this._hideSoundStatusTimeout&&clearTimeout(this._hideSoundStatusTimeout),this._hideSoundStatusTimeout=setTimeout((function(){Qt(e)}),2e3)}else 80===t.keyCode&&(this._paused=!this._paused,this._paused?this.pause():this.resume())}_onChangeScore(t,e){this.elements.score.innerText=e||"00"}_onChangeHighScore(t,e){this.elements.highScore.innerText=e||"00"}_onChangeLives(t,e){0===e&&(this._gameOver=!0,Jt(this.elements.gameOver),this.hideGhosts(),this.pacman.hide(),this.model.save())}_onChangeExtraLives(t,e){this.sound.play("life")}_onChangeMode(t,e){this.emit("game:globalmode",e)}_onGhostEaten(t){this.pacman.hide(),this._pauseFrames=15,this._showPacman=!0,this.model.addScore(parseInt(t.score)),this.sound.play("eat")}_onGhostEat(){this._pauseFrames=40,this._pacmanEaten=!0}template(t){return`\n            <div class="score">\n                <div class="p1-score">1UP<br /><span>00</span></div>\n                <div class="high-score">HIGH SCORE<br /><span>${t.highScore||"00"}</span></div>\n                <div class="p2-score">2UP<br /><span>00</span></div>\n            </div>\n            <div class="start-p1" style="display: none">PLAYER ONE</div>\n            <div class="start-ready" style="display: none">READY!</div>\n            <div class="game-over" style="display: none">GAME OVER</div>\n            <div class="sound-status on" style="display: none"><span class="wrap">SOUND: <span class="on">ON</span><span class="off">OFF</span></span></div>\n            <div class="paused" style="display: none"><span class="wrap">PAUSED</span></div>\n            <div class="splash">\n                <span class="title">"JS PAC-MAN"</span>\n                <p class="nerd">HTML - CSS<br><br><span>JAVASCRIPT</span></p>\n                <a class="start" style="display: none">START</a>\n                <div class="loadbar"><div class="inner"></div></div>\n                <p class="keys"><span>&larr;&uarr;&darr;&rarr;</span>:MOVE <span>S</span>:SOUND <span>P</span>:PAUSE</p>\n                <div class="credits">&#169; 2014-${(new Date).getFullYear()} <span>8</span>TENTACULOS <a href="https://github.com/8tentaculos/jsPacman">SOURCE+INFO</a></div>\n            </div>\n        `}}Object.assign(te.prototype,Zt);const ee=te;window.addEventListener("load",(t=>{document.querySelector(".js-pacman-container");const e=Math.max(document.documentElement.clientWidth||0,window.innerWidth||0),s=Math.max(document.documentElement.clientHeight||0,window.innerHeight||0);new class extends ee{constructor(t){super(t),this.el.style.left="50%",this.el.style.marginLeft=`-${this.el.offsetWidth/2}px`,this.el.style.top="50%",this.el.style.marginTop=`-${this.el.offsetHeight/2}px`}}({el:document.querySelector(".js-pacman-playground"),width:.9*e,height:.9*s})}))})();